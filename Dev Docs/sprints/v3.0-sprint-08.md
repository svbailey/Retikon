# V3.0 Sprint 08 - Compaction + retention optimization (Pro)

Dates: TBD
Owner: TBD

## Goal
Mandatory compaction and tiered retention.

## Scope checklist
- [x] Add compaction core in retikon_core/compaction/.
- [x] Define target file size policy and partitioning logic in retikon_core/compaction/policy.py.
- [x] Add compaction job entrypoint in gcp_adapter/compaction_service.py.
- [x] Add retention/tiering config in retikon_core/retention/.
- [x] Add integrity checks and compaction audit logs in retikon_core/audit/.
- [x] Update Terraform for compaction jobs and scheduler.

## Primary paths
- `retikon_core/compaction/`
- `retikon_core/compaction/policy.py`
- `gcp_adapter/compaction_service.py`
- `retikon_core/retention/`
- `retikon_core/audit/`
- `infrastructure/terraform/`

## Tests and validation
- [x] `python -m pytest -q` (68 passed, 7 warnings)
- [x] `python -m ruff check .`

## Deliverables
- [x] Compaction job + scheduler defined in Terraform
- [x] Retention policies and audit logs available

## Risks / Dependencies
- [ ] Follow-up: FastAPI `on_event` deprecation warnings (gcp_adapter/query_service.py, local_adapter/query_service.py).
- [ ] Follow-up: google._upb._message DeprecationWarning (upstream protobuf).
- [ ] Follow-up: torch numpy init warning in tests (torch/nn/modules/transformer.py).

## Notes
- Scheduler uses Cloud Scheduler + Cloud Run Jobs API; ensure API is enabled before apply.
- Tests last run: 2026-01-27.
